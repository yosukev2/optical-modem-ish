# wiring_v1.md — W2 暫定配線（Pico + PLT133/PLR237 + 1m POF）

## Why（目的）
- **最小構成で光リンクが動くかどうかの動作確認**（W3以降の基板設計を迷わせない）
- 詰まる可能性があるポイント（向き/ピン取り/測り方/安全）も前もって **詳細手順化し再現可能** にする

## What（やること）
- Raspberry Pi Pico（RP2040）と Everlight **PLT133/T10W（Tx）**、**PLR237/T10BK（Rx）** をブレッドボード配線
- PicoのGPIOでTx入力をトグルし、Rx出力の変化を確認
- **W2はPicoの3V3(OUT)給電で固定**（W3以降は VBUS→保護→LDO→3.3V に移行予定）

## Done（受け入れ条件 / Acceptance Criteria）
- [ ] 配線が「電源→信号→光」の順に安全に組めた（ショート/逆接の未然防止ができた）
- [ ] Txトグルに対してRx出力が変化する（LED/テスター/ロジアナのいずれかで確認）
- [ ] 失敗時の切り分け（向き/配線/電源/設定/ファイバ）がこのドキュメントだけで進められる

## Notes（調査メモ / 参考）
- **PLT133（Tx）ピン**：1=Vin, 2=Vcc, 3=GND（ピン機能表に明記）
- **PLR237（Rx）**：データシート図中の表記では3端子が **Vcc / GND / Vout** として示される（測定回路/アプリ回路図）。ピン番号は「足を下、光コネクタを上、正面から見て左→右が1→2→3」の一般的な読み方で扱い、**左=Vcc、中央=GND、右=Vout** として配線する（不安な場合はデータシートのパッケージ寸法図と図中表記を突合）。
- Rx（PLR237 Vout）は **Pico内蔵プルダウン** で対応（外付け抵抗は無し）。
- オシロなし前提：まずは **LED/テスター/ロジアナ** で「変化がある」事実を取る。

---

## 0. 使うもの（W2）
- MCU：Raspberry Pi **Pico（RP2040）**
- Tx：Everlight **PLT133/T10W**
- Rx：Everlight **PLR237/T10BK**
- POF：TOSLINK互換 **1m 光デジタル（POF）**
- ブレッドボード、ジャンパ線
- （推奨）テスター、（あれば）ロジックアナライザ、（任意）LED+抵抗
- デカップリング：0.1uF（Tx/Rx 各1個）

---

## 1. 重要な前提（安全・壊さない）
1) **必ず電源OFFで配線する**（電源ONのまま抜き差ししない）
2) **VccとGND逆は即死**：まずテスターでショートが無いことを確認
3) **電圧は3.3Vで統一**：W2はPicoの3V3(OUT)のみ使う（VBUS直結はしない）
4) **デカップリングは必須**：Rxデータシートでは 0.1uF をVcc-GNDに近接配置する例が示され、C1/C2は 7mm以内配置が推奨されている（基板化するW3では特に重要）

---

## 2. 配線の全体像（ブロック図）

```
(USB)             (W2: Pico内蔵3.3V)
PC ─USB─> Pico ──3V3(OUT)─────────────┬─────────> PLT133 Vcc (Pin2)
               GND ───────────────────┼─────────> PLT133 GND (Pin3)
               GP2 (Tx Data)──────────┴─────────> PLT133 Vin (Pin1)

Pico 3V3(OUT)─────────────────────────┬─────────> PLR237 Vcc (左ピン)
Pico GND ─────────────────────────────┼─────────> PLR237 GND (中央ピン)
Pico GP3 (Rx Data In) <────────────────┴─────────> PLR237 Vout (右ピン)

PLT133（Tx）──(POF 1m)──> PLR237（Rx）
```

- **GPIO割り当て（暫定）**
  - Tx入力：Pico **GP2** → PLT133 Vin
  - Rx出力：PLR237 Vout → Pico **GP3**

---

## 3. 部品ごとのピン取り（向き・番号）

### 3.1 PLT133/T10W（Tx）
- **Pin1 = Vin**（入力）
- **Pin2 = Vcc**（3.3V）
- **Pin3 = GND**

**向きの考え方（初心者向け）**
- まず「データシートのピン番号が振られた図」と「ピン機能表（1/2/3）」をセットで見る
- ブレッドボードでは、**Pin2に3.3V、Pin3にGND** を入れてから **Pin1にGPIO** を入れる（順番が安全）

### 3.2 PLR237/T10BK（Rx）
- データシートの測定/アプリ回路図では、3端子が **Vcc / GND / Vout** として示される
- W2では配線ミスを避けるため、以下の **見た目基準** で固定する：
  - **足を下**、**光コネクタを上**、**正面（光差し込み側）から見て**
  - **左=Vcc、中央=GND、右=Vout**

### 3.3 ピン配置（簡易ASCII図）
#### PLT133/T10W（Tx）※足を下、正面（光差し込み側）から見たイメージ
┌─────────┐
│ [光] │
└─────────┘
1 2 3
Vin Vcc GND

#### PLR237/T10BK（Rx）※足を下、光コネクタを上、正面から見たイメージ
┌─────────┐
│ [光] │
└─────────┘
左 中 右
Vcc GND Vout

---

## 4. 具体配線（手順）

### 4.1 電源（先にここだけ完成させる）
1. PicoをUSBにつながず、ブレッドボードに置く
2. **Pico 3V3(OUT) → ブレッドボード3.3Vレール**
3. **Pico GND → ブレッドボードGNDレール**
4. テスターで **3.3VレールとGNDがショートしてない** ことを確認

### 4.2 Tx（PLT133）
1. PLT133 **Pin2(Vcc) → 3.3V**
2. PLT133 **Pin3(GND) → GND**
3. PLT133 **Pin1(Vin) → Pico GP2**
4. **0.1uF を PLT133 の Vcc-GND 間に近接**（足元でOK）

### 4.3 Rx（PLR237）
1. PLR237 **Vcc(左) → 3.3V**
2. PLR237 **GND(中央) → GND**
3. PLR237 **Vout(右) → Pico GP3**
4. **0.1uF を PLR237 の Vcc-GND 間に近接**
5. Picoの **GP3 に内蔵プルダウン** を有効化（後述）

### 4.4 ブレッドボード版テストポイント（TP）
> ブレッドボード上に「分岐点」を作って測定点にする。

- TP_GND：GNDレール上の任意の穴（ここにプローブのGNDクリップを固定）
- TP_3V3：3.3Vレール上の任意の穴（電圧確認用）
- TP_TX：GP2 → PLT133 Vin の途中に「分岐列」を作る  
  - 配線：GP2 → (TP_TX列) → PLT133 Vin
  - 測定：TP_TX列の“測定用ピン”にロジアナ/オシロを当てる
- TP_RX：PLR237 Vout → GP3 の途中に「分岐列」を作る  
  - 配線：PLR237 Vout → (TP_RX列) → GP3
  - 測定：TP_RX列の“測定用ピン”にロジアナ/オシロを当てる

### 4.4 光（POF）
- PLT133（Tx）→ PLR237（Rx）へ **POFを接続**
- まずは「抜けにくい/曲げすぎない/コネクタ奥まで刺さる」を確認


---

## 5. 動作確認（オシロなし想定）

### 5.1 最小の確認ステップ（おすすめ順）
1) **電圧確認**
- PicoをUSB給電し、3V3レールが **約3.3V** になっている

2) **GPIOが動いている確認（Tx側）**
- GP2 を 1Hz〜10Hz でON/OFFトグル（LEDでも見える）

3) **Rxが変化する確認**
- GP3 の入力を読み、シリアルログに出す（0/1が切り替わるか）
- または GP3 にLED（+抵抗）をつないで点滅を見る（ただし極性と電流に注意）

### 5.2 Pico側の最小コード（例：Arduino-Pico / pico-sdk どちらでも可）
- 要点は2つだけ：
  - **GP2 = 出力でトグル**
  - **GP3 = 入力 + PULLDOWN**

（実装言語/環境はW1〜の方針に合わせる。ここではロジックのみ）

---

## 6. 期待結果（OK/NGの見分け方）

### OK
- GP2をトグルすると、**GP3が同じタイミングで 0/1 変化**する
- 低速（数Hz〜数kHz）でもまず反応が取れる

### よくあるNGと切り分け
1) **GP3がずっと0/ずっと1**
- ファイバ未接続、向き違い、Rx電源未供給、Rxピン取り間違い

2) **GP2は動いているがGP3が変化しない**
- TxのVin/Vcc/GNDの取り違え（Pin1/2/3）
- RxのVcc/GND/Voutの取り違え（左/中/右）

3) **不安定（揺れる/ノイズっぽい）**
- デカップリング不足（0.1uFが遠い/無い）
- GNDが細く長い、配線がぐちゃぐちゃ（まず短く整理）

4) **プルダウン無し（FLOAT）っぽい**
- 症状：GP3がランダムに0/1で揺れる／触ると変わる／ファイバ未接続でも値が安定しない
- 対処：GP3を **入力 + PULLDOWN** に設定（または外付けで10k〜100kをGNDへ）


5) **電源不足（3V3ドロップ）**
- 症状：3V3が3.3V付近にならない／動いたり動かなかったり不安定／Rxが全く切り替わらない
- 対処：3V3(OUT)を再測定、USBケーブル/ポート変更、配線短縮、0.1uFをTx/Rx近くに追加

---

## 7. W2とW3の違い（混乱ポイントを先に潰す）
- **W2（この配線）**：Picoの **3V3(OUT)** を使って、最短で動くかどうかの確認を行う。
- **W3（基板）**：USBの **VBUS(5V)** を入力として、
  - Polyfuse（過電流）
  - TVS（サージ/ESD）
  - LDO（5V→3.3V安定化）
  の「評価ボードっぽい正しい型」にする


